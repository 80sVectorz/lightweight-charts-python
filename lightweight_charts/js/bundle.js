var Lib=function(e,t){"use strict";const i={backgroundColor:"#0c0d0f",hoverBackgroundColor:"#3c434c",clickBackgroundColor:"#50565E",activeBackgroundColor:"rgba(0, 122, 255, 0.7)",mutedBackgroundColor:"rgba(0, 122, 255, 0.3)",borderColor:"#3C434C",color:"#d8d9db",activeColor:"#ececed"};function s(){window.pane={...i},window.containerDiv=document.getElementById("container")||document.createElement("div"),window.setCursor=e=>{e&&(window.cursor=e),document.body.style.cursor=window.cursor},window.cursor="default",window.textBoxFocused=!1}const o=new Map;function n(e){return o.get(e)||null}const r='\n<svg xmlns="http://www.w3.org/2000/svg" width="22" height="16" viewBox="0 0 24 24">\n    <path style="fill:none;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;stroke:#FFF;stroke-opacity:1;stroke-miterlimit:4;" \n          d="M 21.998437 12 C 21.998437 12 18.998437 18 12 18 \n             C 5.001562 18 2.001562 12 2.001562 12 \n             C 2.001562 12 5.001562 6 12 6 \n             C 18.998437 6 21.998437 12 21.998437 12 Z" />\n    <path style="fill:none;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;stroke:#FFF;stroke-opacity:1;stroke-miterlimit:4;" \n          d="M 15 12 \n             C 15 13.654687 13.654687 15 12 15 \n             C 10.345312 15 9 13.654687 9 12 \n             C 9 10.345312 10.345312 9 12 9 \n             C 13.654687 9 15 10.345312 15 12 Z" />\n</svg>\n',a='\n<svg xmlns="http://www.w3.org/2000/svg" width="22" height="16" viewBox="0 0 24 24">\n <path style="fill:none;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;stroke:#FFF;stroke-opacity:1;stroke-miterlimit:4;" \n          d="M 3 3 L 21 21" />\n    <path style="fill:none;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;stroke:#FFF;stroke-opacity:1;stroke-miterlimit:4;" \n          d="M 21.998437 12 \n             C 21.998437 12 18.998437 18 12 18 \n             C 5.001562 18 2.001562 12 2.001562 12 \n             C 2.001562 12 5.001562 6 12 6 \n             C 14.211 6 16.106 6.897 17.7 8.1" />\n    <path style="fill:none;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;stroke:#FFF;stroke-opacity:1;stroke-miterlimit:4;" \n          d="M 9.9 9.9 \n             C 9.367 10.434 9 11.178 9 12 \n             C 9 13.654687 10.345312 15 12 15 \n             C 12.822 15 13.566 14.633 14.1 14.1" />\n</svg>\n';class l{handler;div;seriesContainer;ohlcEnabled=!1;percentEnabled=!1;linesEnabled=!1;colorBasedOnCandle=!1;text;candle;_items=[];_lines=[];_groups=[];constructor(e){this.handler=e,this.div=document.createElement("div"),this.div.classList.add("legend"),this.seriesContainer=document.createElement("div"),this.text=document.createElement("span"),this.candle=document.createElement("div"),this.setupLegend(),this.legendHandler=this.legendHandler.bind(this),e.chart.subscribeCrosshairMove(this.legendHandler)}setupLegend(){this.div.style.maxWidth=100*this.handler.scale.width-8+"vw",this.div.style.display="none";const e=document.createElement("div");e.style.display="flex",e.style.flexDirection="row",this.seriesContainer.classList.add("series-container"),this.text.style.lineHeight="1.8",e.appendChild(this.seriesContainer),this.div.appendChild(this.text),this.div.appendChild(this.candle),this.div.appendChild(e),this.handler.div.appendChild(this.div)}legendItemFormat(e,t){return"number"!=typeof e||isNaN(e)?"-":e.toFixed(t).toString().padStart(8," ")}shorthandFormat(e){const t=Math.abs(e);return t>=1e6?(e/1e6).toFixed(1)+"M":t>=1e3?(e/1e3).toFixed(1)+"K":e.toString().padStart(8," ")}makeSeriesRow(e){const t=document.createElement("div");t.style.display="flex",t.style.alignItems="center";const i=document.createElement("div");if(["Bar","ohlc"].includes(e.seriesType||"")){const t="-",s="-",o=e.legendSymbol[0]||"▨",n=e.legendSymbol[1]||o,r=e.colors[0]||"#00FF00",a=e.colors[1]||"#FF0000";i.innerHTML=`\n                <span style="color: ${r};">${o}</span>\n                <span style="color: ${a};">${n}</span>\n                ${e.name}: <span style="color: ${a};">O ${t}</span>, \n                <span style="color: ${r};">C ${s}</span>\n            `}else i.innerHTML=e.legendSymbol.map(((t,i)=>`<span style="color: ${e.colors[i]||e.colors[0]};">${t}</span>`)).join(" ")+` ${e.name}`;const s=document.createElement("div");s.classList.add("legend-toggle-switch");const o=this.createSvgIcon(r),n=this.createSvgIcon(a);s.appendChild(o.cloneNode(!0));let l=!0;s.addEventListener("click",(()=>{l=!l,e.series.applyOptions({visible:l}),s.innerHTML="",s.appendChild(l?o.cloneNode(!0):n.cloneNode(!0))})),t.appendChild(i),t.appendChild(s),this.seriesContainer.appendChild(t);const h={...e,div:i,row:t,toggle:s};return this._lines.push(h),t}addLegendItem(e){if(e.group){let t=this._groups.find((t=>t.name===e.group));if(t)return t.seriesList.push(e),this._items.push(e),t.row;{const t=this.makeSeriesGroup(e.group,[e]);return this._groups[this._groups.length-1],t}}{const t=this.makeSeriesRow(e);return this._lines[this._lines.length-1],this._items.push(e),t}}deleteLegendEntry(e,t){if(t&&!e){const e=this._groups.findIndex((e=>e.name===t));if(-1!==e){const t=this._groups[e];this.seriesContainer.removeChild(t.row),this._groups.splice(e,1),this._items=this._items.filter((e=>e!==t))}else console.warn(`Legend group with name "${t}" not found.`)}else if(e){let i=!1;if(t){const s=this._groups.find((e=>e.name===t));if(s){const o=s.seriesList.findIndex((t=>t.name===e));-1!==o&&(s.seriesList[o],s.seriesList.splice(o,1),0===s.seriesList.length&&(this.seriesContainer.removeChild(s.row),this._groups=this._groups.filter((e=>e!==s)),this._items=this._items.filter((e=>e!==s)),console.log(`Group "${t}" is empty and has been removed.`)),i=!0,console.log(`Series "${e}" removed from group "${t}".`))}else console.warn(`Legend group with name "${t}" not found.`)}if(!i){const t=this._lines.findIndex((t=>t.name===e));if(-1!==t){const s=this._lines[t];this.seriesContainer.removeChild(s.row),this._lines.splice(t,1),this._items=this._items.filter((e=>e!==s)),i=!0,console.log(`Series "${e}" removed.`)}}i||console.warn(`Legend item with name "${e}" not found.`)}else console.warn("No seriesName or groupName provided for deletion.")}makeSeriesGroup(e,t){let i=this._groups.find((t=>t.name===e));if(i)return i.seriesList.push(...t),i.row;{const i=document.createElement("div");i.style.display="flex",i.style.alignItems="center";const s=document.createElement("div");s.innerHTML=`<span style="font-weight: bold;">${e}:</span>`;const o=document.createElement("div");o.classList.add("legend-toggle-switch");const n=this.createSvgIcon(r),l=this.createSvgIcon(a);o.appendChild(n.cloneNode(!0));let h=!0;o.addEventListener("click",(()=>{h=!h,t.forEach((e=>e.series.applyOptions({visible:h}))),o.innerHTML="",o.appendChild(h?n.cloneNode(!0):l.cloneNode(!0))})),t.forEach((e=>{if("Bar"===e.seriesType||"ohlc"===e.seriesType){const[t,i]=e.legendSymbol,[o,n]=e.colors,r="-",a="-";s.innerHTML+=`\n                    <span style="color: ${o};">${t}</span>\n                    <span style="color: ${n};">${i}</span>\n                    <span>${name}: \n                        <span style="color: ${n};">O ${r}</span>, \n                        <span style="color: ${o};">C ${a}</span>\n                    </span>\n                `}else{const t=e.colors[0]||"#000",i=e.legendSymbol[0]||"▨",o="-";s.innerHTML+=`\n                    <span style="color: ${t};">${i}</span>\n                    <span>${name}: ${o}</span>\n                `}})),i.appendChild(s),i.appendChild(o),this.seriesContainer.appendChild(i);const d={name:e,seriesList:t,div:s,row:i,toggle:o};return this._groups.push(d),i}}createSvgIcon(e){const t=document.createElement("div");t.innerHTML=e.trim();return t.querySelector("svg")}legendHandler(e,t=!1){if(!this.ohlcEnabled&&!this.linesEnabled&&!this.percentEnabled)return;const i=this.handler.series.options();if(!e.time)return this.candle.style.color="transparent",void(this.candle.innerHTML=this.candle.innerHTML.replace(i.upColor,"").replace(i.downColor,""));let s,o=null;if(t){const t=this.handler.chart.timeScale(),i=t.timeToCoordinate(e.time);i&&(o=t.coordinateToLogical(i.valueOf())),o&&(s=this.handler.series.dataByIndex(o.valueOf()))}else s=e.seriesData.get(this.handler.series);let n='<span style="line-height: 1.8;">';if(s&&(this.ohlcEnabled&&(n+=`O ${this.legendItemFormat(s.open,this.handler.precision)} `,n+=`| H ${this.legendItemFormat(s.high,this.handler.precision)} `,n+=`| L ${this.legendItemFormat(s.low,this.handler.precision)} `,n+=`| C ${this.legendItemFormat(s.close,this.handler.precision)} `),this.percentEnabled)){const e=(s.close-s.open)/s.open*100,t=e>0?i.upColor:i.downColor,o=`${e>=0?"+":""}${e.toFixed(2)} %`;n+=this.colorBasedOnCandle?`| <span style="color: ${t};">${o}</span>`:`| ${o}`}this.candle.innerHTML=n+"</span>",this.updateGroupDisplay(e,o,t),this.updateSeriesDisplay(e,o,t)}updateGroupDisplay(e,t,i){this._groups.forEach((t=>{if(!this.linesEnabled)return void(t.row.style.display="none");t.row.style.display="flex";let i=`<span style="font-weight: bold;">${t.name}:</span> `;t.seriesList.forEach((t=>{const s=e.seriesData.get(t.series)||n(t.series);if(!s)return;const o=t.seriesType||"Line",r=t.name,a=t.series.options().priceFormat;if("Bar"===o||"ohlc"===o||"htfCandle"===o){const{open:e,close:o,high:n,low:l}=s;if(null==e||null==o||null==n||null==l)return;if(null==e||null==o)return void(i+=`${r}: - `);const h=this.legendItemFormat(e,a.precision),d=this.legendItemFormat(o,a.precision),c=o>e,p=c?t.colors[0]:t.colors[1],u=c?t.legendSymbol[0]:t.legendSymbol[1];i+=`\n                        <span style="color: ${p};">${u||"▨"}</span>\n                        <span>${r}: \n                            <span style="color: ${p};">O ${h}</span>, \n                            <span style="color: ${p};">C ${d}</span>\n                        </span> `}else{const e=(s||{}).value;if(null==e)return void(i+=`${r}: - `);const o=t.series.options().priceFormat,n=this.legendItemFormat(e,o.precision),a=t.colors[0],l=t.legendSymbol[0]||"▨";i+=`\n                        <span style="color: ${a};">${l}</span>\n                        <span>${r}: ${n}</span> `}})),t.div.innerHTML=i}))}updateSeriesDisplay(e,t,i){this._lines&&this._lines.length?this._lines.forEach((t=>{if(!this.linesEnabled)return void(t.row.style.display="none");t.row.style.display="flex";const i=e.seriesData.get(t.series)||n(t.series);if(!i)return void(t.div.innerHTML=`${t.name}: -`);const s=t.seriesType||"Line";if(["Bar","ohlc","htfCandle"].includes(s)){const{open:e,close:s}=i;if(null==e||null==s)return void(t.div.innerHTML=`${t.name}: -`);const o=t.series.options().priceFormat,n=this.legendItemFormat(e,o.precision),r=this.legendItemFormat(s,o.precision),a=s>e,l=a?t.colors[0]:t.colors[1],h=a?t.legendSymbol[0]:t.legendSymbol[1];t.div.innerHTML=`\n                    <span style="color: ${l};">${h||"▨"}</span>\n                    ${t.name}: \n                    <span style="color: ${l};">O ${n}</span>, \n                    <span style="color: ${l};">C ${r}</span>\n                `}else if("Histogram"===s){const e=i;if(null==e.value)return void(t.div.innerHTML=`${t.name}: -`);const s=this.shorthandFormat(e.value);t.div.innerHTML=`\n                    <span style="color: ${t.colors[0]};">${t.legendSymbol[0]||"▨"}</span> \n                    ${t.name}: ${s}`}else{const e=i;if(null==e.value)return void(t.div.innerHTML=`${t.name}: -`);const s=t.series.options().priceFormat,o=this.legendItemFormat(e.value,s.precision);t.div.innerHTML=`\n                    <span style="color: ${t.colors[0]};">${t.legendSymbol[0]||"▨"}</span> \n                    ${t.name}: ${o}`}})):console.error("No lines available to update legend.")}}function h(e){if(void 0===e)throw new Error("Value is undefined");return e}class d{_chart=void 0;_series=void 0;requestUpdate(){this._requestUpdate&&this._requestUpdate()}_requestUpdate;attached({chart:e,series:t,requestUpdate:i}){this._chart=e,this._series=t,this._series.subscribeDataChanged(this._fireDataUpdated),this._requestUpdate=i,this.requestUpdate()}detached(){this._chart=void 0,this._series=void 0,this._requestUpdate=void 0}get chart(){return h(this._chart)}get series(){return h(this._series)}_fireDataUpdated(e){this.dataUpdated&&this.dataUpdated(e)}}const c={lineColor:"#1E80F0",lineStyle:t.LineStyle.Solid,width:4};var p;!function(e){e[e.NONE=0]="NONE",e[e.HOVERING=1]="HOVERING",e[e.DRAGGING=2]="DRAGGING",e[e.DRAGGINGP1=3]="DRAGGINGP1",e[e.DRAGGINGP2=4]="DRAGGINGP2",e[e.DRAGGINGP3=5]="DRAGGINGP3",e[e.DRAGGINGP4=6]="DRAGGINGP4"}(p||(p={}));class u extends d{_paneViews=[];_options;_points=[];_state=p.NONE;_startDragPoint=null;_latestHoverPoint=null;static _mouseIsDown=!1;static hoveredObject=null;static lastHoveredObject=null;_listeners=[];constructor(e){super(),this._options={...c,...e}}updateAllViews(){this._paneViews.forEach((e=>e.update()))}paneViews(){return this._paneViews}applyOptions(e){this._options={...this._options,...e},this.requestUpdate()}updatePoints(...e){for(let t=0;t<this.points.length;t++)null!=e[t]&&(this.points[t]=e[t]);this.requestUpdate()}detach(){this._options.lineColor="transparent",this.requestUpdate(),this.series.detachPrimitive(this);for(const e of this._listeners)document.body.removeEventListener(e.name,e.listener)}get points(){return this._points}_subscribe(e,t){document.body.addEventListener(e,t),this._listeners.push({name:e,listener:t})}_unsubscribe(e,t){document.body.removeEventListener(e,t);const i=this._listeners.find((i=>i.name===e&&i.listener===t));this._listeners.splice(this._listeners.indexOf(i),1)}_handleHoverInteraction(e){if(this._latestHoverPoint=e.point,u._mouseIsDown)this._handleDragInteraction(e);else if(this._mouseIsOverDrawing(e)){if(this._state!=p.NONE)return;this._moveToState(p.HOVERING),u.hoveredObject=u.lastHoveredObject=this}else{if(this._state==p.NONE)return;this._moveToState(p.NONE),u.hoveredObject===this&&(u.hoveredObject=null)}}static _eventToPoint(e,t){if(!t||!e.point||!e.logical)return null;const i=t.coordinateToPrice(e.point.y);return null==i?null:{time:e.time||null,logical:e.logical,price:i.valueOf()}}static _getDiff(e,t){return{logical:e.logical-t.logical,price:e.price-t.price}}_addDiffToPoint(e,t,i){e&&(e.logical=e.logical+t,e.price=e.price+i,e.time=this.series.dataByIndex(e.logical)?.time||null)}_handleMouseDownInteraction=()=>{u._mouseIsDown=!0,this._onMouseDown()};_handleMouseUpInteraction=()=>{u._mouseIsDown=!1,this._moveToState(p.HOVERING)};_handleDragInteraction(e){if(this._state!=p.DRAGGING&&this._state!=p.DRAGGINGP1&&this._state!=p.DRAGGINGP2&&this._state!=p.DRAGGINGP3&&this._state!=p.DRAGGINGP4)return;const t=u._eventToPoint(e,this.series);if(!t)return;this._startDragPoint=this._startDragPoint||t;const i=u._getDiff(t,this._startDragPoint);this._onDrag(i),this.requestUpdate(),this._startDragPoint=t}}class _{_options;constructor(e){this._options=e}}class m extends _{_p1;_p2;_hovered;constructor(e,t,i,s){super(i),this._p1=e,this._p2=t,this._hovered=s}_getScaledCoordinates(e){return null===this._p1.x||null===this._p1.y||null===this._p2.x||null===this._p2.y?null:{x1:Math.round(this._p1.x*e.horizontalPixelRatio),y1:Math.round(this._p1.y*e.verticalPixelRatio),x2:Math.round(this._p2.x*e.horizontalPixelRatio),y2:Math.round(this._p2.y*e.verticalPixelRatio)}}_drawEndCircle(e,t,i){e.context.fillStyle="#000",e.context.beginPath(),e.context.arc(t,i,9,0,2*Math.PI),e.context.stroke(),e.context.fill()}}function g(e,i){const s={[t.LineStyle.Solid]:[],[t.LineStyle.Dotted]:[e.lineWidth,e.lineWidth],[t.LineStyle.Dashed]:[2*e.lineWidth,2*e.lineWidth],[t.LineStyle.LargeDashed]:[6*e.lineWidth,6*e.lineWidth],[t.LineStyle.SparseDotted]:[e.lineWidth,4*e.lineWidth]}[i];e.setLineDash(s)}class w extends _{_point={x:null,y:null};constructor(e,t){super(t),this._point=e}draw(e){e.useBitmapCoordinateSpace((e=>{if(null==this._point.y)return;const t=e.context,i=Math.round(this._point.y*e.verticalPixelRatio),s=this._point.x?this._point.x*e.horizontalPixelRatio:0;t.lineWidth=this._options.width,t.strokeStyle=this._options.lineColor,g(t,this._options.lineStyle),t.beginPath(),t.moveTo(s,i),t.lineTo(e.bitmapSize.width,i),t.stroke()}))}}class v{_source;constructor(e){this._source=e}}class y extends v{_p1={x:null,y:null};_p2={x:null,y:null};_source;constructor(e){super(e),this._source=e}update(){if(!this._source.p1||!this._source.p2)return;const e=this._source.series,t=e.priceToCoordinate(this._source.p1.price),i=e.priceToCoordinate(this._source.p2.price),s=this._getX(this._source.p1),o=this._getX(this._source.p2);this._p1={x:s,y:t},this._p2={x:o,y:i}}_getX(e){return this._source.chart.timeScale().logicalToCoordinate(e.logical)}}class b extends v{_source;_point={x:null,y:null};constructor(e){super(e),this._source=e}update(){const e=this._source._point,t=this._source.chart.timeScale(),i=this._source.series;"RayLine"==this._source._type&&(this._point.x=e.time?t.timeToCoordinate(e.time):t.logicalToCoordinate(e.logical)),this._point.y=i.priceToCoordinate(e.price)}renderer(){return new w(this._point,this._source._options)}}class f{_source;_y=null;_price=null;constructor(e){this._source=e}update(){if(!this._source.series||!this._source._point)return;this._y=this._source.series.priceToCoordinate(this._source._point.price);const e=this._source.series.options().priceFormat.precision;this._price=this._source._point.price.toFixed(e).toString()}visible(){return!0}tickVisible(){return!0}coordinate(){return this._y??0}text(){return this._source._options.text||this._price||""}textColor(){return"white"}backColor(){return this._source._options.lineColor}}class x extends u{_type="HorizontalLine";_paneViews;_point;_callbackName;_priceAxisViews;_startDragPoint=null;constructor(e,t,i=null){super(t),this._point=e,this._point.time=null,this._paneViews=[new b(this)],this._priceAxisViews=[new f(this)],this._callbackName=i}get points(){return[this._point]}updatePoints(...e){for(const t of e)t&&(this._point.price=t.price);this.requestUpdate()}updateAllViews(){this._paneViews.forEach((e=>e.update())),this._priceAxisViews.forEach((e=>e.update()))}priceAxisViews(){return this._priceAxisViews}_moveToState(e){switch(e){case p.NONE:document.body.style.cursor="default",this._unsubscribe("mousedown",this._handleMouseDownInteraction);break;case p.HOVERING:document.body.style.cursor="pointer",this._unsubscribe("mouseup",this._childHandleMouseUpInteraction),this._subscribe("mousedown",this._handleMouseDownInteraction),this.chart.applyOptions({handleScroll:!0});break;case p.DRAGGING:document.body.style.cursor="grabbing",this._subscribe("mouseup",this._childHandleMouseUpInteraction),this.chart.applyOptions({handleScroll:!1})}this._state=e}_onDrag(e){this._addDiffToPoint(this._point,0,e.price),this.requestUpdate()}_mouseIsOverDrawing(e,t=4){if(!e.point)return!1;const i=this.series.priceToCoordinate(this._point.price);return!!i&&Math.abs(i-e.point.y)<t}_onMouseDown(){this._startDragPoint=null;if(this._latestHoverPoint)return this._moveToState(p.DRAGGING)}_childHandleMouseUpInteraction=()=>{this._handleMouseUpInteraction(),this._callbackName&&window.callbackFunction(`${this._callbackName}_~_${this._point.price.toFixed(8)}`)}}class C{_chart;_series;_finishDrawingCallback=null;_drawings=[];_activeDrawing=null;_isDrawing=!1;_drawingType=null;constructor(e,t,i=null){this._chart=e,this._series=t,this._finishDrawingCallback=i,this._chart.subscribeClick(this._clickHandler),this._chart.subscribeCrosshairMove(this._moveHandler)}_clickHandler=e=>this._onClick(e);_moveHandler=e=>this._onMouseMove(e);beginDrawing(e){this._drawingType=e,this._isDrawing=!0}stopDrawing(){this._isDrawing=!1,this._activeDrawing=null}get drawings(){return this._drawings}addNewDrawing(e){this._series.attachPrimitive(e),this._drawings.push(e)}delete(e){if(null==e)return;const t=this._drawings.indexOf(e);-1!=t&&(this._drawings.splice(t,1),e.detach())}clearDrawings(){for(const e of this._drawings)e.detach();this._drawings=[]}repositionOnTime(){for(const e of this.drawings){const t=[];for(const i of e.points){if(!i){t.push(i);continue}const e=i.time?this._chart.timeScale().coordinateToLogical(this._chart.timeScale().timeToCoordinate(i.time)||0):i.logical;t.push({time:i.time,logical:e,price:i.price})}e.updatePoints(...t)}}_onClick(e){if(!this._isDrawing)return;const t=u._eventToPoint(e,this._series);if(t)if(null==this._activeDrawing){if(null==this._drawingType)return;this._activeDrawing=new this._drawingType(t,t),this._series.attachPrimitive(this._activeDrawing),this._drawingType==x&&this._onClick(e)}else{if(this._drawings.push(this._activeDrawing),this.stopDrawing(),!this._finishDrawingCallback)return;this._finishDrawingCallback()}}_onMouseMove(e){if(!e)return;for(const t of this._drawings)t._handleHoverInteraction(e);if(!this._isDrawing||!this._activeDrawing)return;const t=u._eventToPoint(e,this._series);t&&this._activeDrawing.updatePoints(null,t)}}class k extends m{constructor(e,t,i,s){super(e,t,i,s)}draw(e){e.useBitmapCoordinateSpace((e=>{if(null===this._p1.x||null===this._p1.y||null===this._p2.x||null===this._p2.y)return;const t=e.context,i=this._getScaledCoordinates(e);i&&(t.lineWidth=this._options.width,t.strokeStyle=this._options.lineColor,g(t,this._options.lineStyle),t.beginPath(),t.moveTo(i.x1,i.y1),t.lineTo(i.x2,i.y2),t.stroke(),this._hovered&&(this._drawEndCircle(e,i.x1,i.y1),this._drawEndCircle(e,i.x2,i.y2)))}))}}class S extends y{constructor(e){super(e)}renderer(){return new k(this._p1,this._p2,this._source._options,this._source.hovered)}}class D extends u{_paneViews=[];_hovered=!1;constructor(e,t,i){super(),this.points.push(e),this.points.push(t),this._options={...c,...i}}setFirstPoint(e){this.updatePoints(e)}setSecondPoint(e){this.updatePoints(null,e)}get p1(){return this.points[0]}get p2(){return this.points[1]}get hovered(){return this._hovered}}class L extends D{_type="TrendLine";constructor(e,t,i){super(e,t,i),this._paneViews=[new S(this)]}_moveToState(e){switch(e){case p.NONE:document.body.style.cursor="default",this._hovered=!1,this.requestUpdate(),this._unsubscribe("mousedown",this._handleMouseDownInteraction);break;case p.HOVERING:document.body.style.cursor="pointer",this._hovered=!0,this.requestUpdate(),this._subscribe("mousedown",this._handleMouseDownInteraction),this._unsubscribe("mouseup",this._handleMouseDownInteraction),this.chart.applyOptions({handleScroll:!0});break;case p.DRAGGINGP1:case p.DRAGGINGP2:case p.DRAGGING:document.body.style.cursor="grabbing",this._subscribe("mouseup",this._handleMouseUpInteraction),this.chart.applyOptions({handleScroll:!1})}this._state=e}_onDrag(e){this._state!=p.DRAGGING&&this._state!=p.DRAGGINGP1||this._addDiffToPoint(this.p1,e.logical,e.price),this._state!=p.DRAGGING&&this._state!=p.DRAGGINGP2||this._addDiffToPoint(this.p2,e.logical,e.price)}_onMouseDown(){this._startDragPoint=null;const e=this._latestHoverPoint;if(!e)return;const t=this._paneViews[0]._p1,i=this._paneViews[0]._p2;if(!(t.x&&i.x&&t.y&&i.y))return this._moveToState(p.DRAGGING);Math.abs(e.x-t.x)<10&&Math.abs(e.y-t.y)<10?this._moveToState(p.DRAGGINGP1):Math.abs(e.x-i.x)<10&&Math.abs(e.y-i.y)<10?this._moveToState(p.DRAGGINGP2):this._moveToState(p.DRAGGING)}_mouseIsOverDrawing(e,t=4){if(!e.point)return!1;const i=this._paneViews[0]._p1.x,s=this._paneViews[0]._p1.y,o=this._paneViews[0]._p2.x,n=this._paneViews[0]._p2.y;if(!(i&&o&&s&&n))return!1;const r=e.point.x,a=e.point.y;if(r<=Math.min(i,o)-t||r>=Math.max(i,o)+t)return!1;return Math.abs((n-s)*r-(o-i)*a+o*s-n*i)/Math.sqrt((n-s)**2+(o-i)**2)<=t}}class T extends m{constructor(e,t,i,s){super(e,t,i,s)}draw(e){e.useBitmapCoordinateSpace((e=>{const t=e.context,i=this._getScaledCoordinates(e);if(!i)return;t.lineWidth=this._options.width,t.strokeStyle=this._options.lineColor,g(t,this._options.lineStyle),t.fillStyle=this._options.fillColor;const s=Math.min(i.x1,i.x2),o=Math.min(i.y1,i.y2),n=Math.abs(i.x1-i.x2),r=Math.abs(i.y1-i.y2);t.strokeRect(s,o,n,r),t.fillRect(s,o,n,r),this._hovered&&(this._drawEndCircle(e,s,o),this._drawEndCircle(e,s+n,o),this._drawEndCircle(e,s+n,o+r),this._drawEndCircle(e,s,o+r))}))}}class E extends y{constructor(e){super(e)}renderer(){return new T(this._p1,this._p2,this._source._options,this._source.hovered)}}const I={fillEnabled:!0,fillColor:"rgba(255, 255, 255, 0.2)",...c};class M extends D{_type="Box";constructor(e,t,i){super(e,t,i),this._options={...I,...i},this._paneViews=[new E(this)]}_moveToState(e){switch(e){case p.NONE:document.body.style.cursor="default",this._hovered=!1,this._unsubscribe("mousedown",this._handleMouseDownInteraction);break;case p.HOVERING:document.body.style.cursor="pointer",this._hovered=!0,this._unsubscribe("mouseup",this._handleMouseUpInteraction),this._subscribe("mousedown",this._handleMouseDownInteraction),this.chart.applyOptions({handleScroll:!0});break;case p.DRAGGINGP1:case p.DRAGGINGP2:case p.DRAGGINGP3:case p.DRAGGINGP4:case p.DRAGGING:document.body.style.cursor="grabbing",document.body.addEventListener("mouseup",this._handleMouseUpInteraction),this._subscribe("mouseup",this._handleMouseUpInteraction),this.chart.applyOptions({handleScroll:!1})}this._state=e}_onDrag(e){this._state!=p.DRAGGING&&this._state!=p.DRAGGINGP1||this._addDiffToPoint(this.p1,e.logical,e.price),this._state!=p.DRAGGING&&this._state!=p.DRAGGINGP2||this._addDiffToPoint(this.p2,e.logical,e.price),this._state!=p.DRAGGING&&(this._state==p.DRAGGINGP3&&(this._addDiffToPoint(this.p1,e.logical,0),this._addDiffToPoint(this.p2,0,e.price)),this._state==p.DRAGGINGP4&&(this._addDiffToPoint(this.p1,0,e.price),this._addDiffToPoint(this.p2,e.logical,0)))}_onMouseDown(){this._startDragPoint=null;const e=this._latestHoverPoint,t=this._paneViews[0]._p1,i=this._paneViews[0]._p2;if(!(t.x&&i.x&&t.y&&i.y))return this._moveToState(p.DRAGGING);const s=10;Math.abs(e.x-t.x)<s&&Math.abs(e.y-t.y)<s?this._moveToState(p.DRAGGINGP1):Math.abs(e.x-i.x)<s&&Math.abs(e.y-i.y)<s?this._moveToState(p.DRAGGINGP2):Math.abs(e.x-t.x)<s&&Math.abs(e.y-i.y)<s?this._moveToState(p.DRAGGINGP3):Math.abs(e.x-i.x)<s&&Math.abs(e.y-t.y)<s?this._moveToState(p.DRAGGINGP4):this._moveToState(p.DRAGGING)}_mouseIsOverDrawing(e,t=4){if(!e.point)return!1;const i=this._paneViews[0]._p1.x,s=this._paneViews[0]._p1.y,o=this._paneViews[0]._p2.x,n=this._paneViews[0]._p2.y;if(!(i&&o&&s&&n))return!1;const r=e.point.x,a=e.point.y,l=Math.min(i,o),h=Math.min(s,n),d=Math.abs(i-o),c=Math.abs(s-n),p=t/2;return r>l-p&&r<l+d+p&&a>h-p&&a<h+c+p}}class G{colorOption;static colors=["#EBB0B0","#E9CEA1","#E5DF80","#ADEB97","#A3C3EA","#D8BDED","#E15F5D","#E1B45F","#E2D947","#4BE940","#639AE1","#D7A0E8","#E42C2A","#E49D30","#E7D827","#3CFF0A","#3275E4","#B06CE3","#F3000D","#EE9A14","#F1DA13","#2DFC0F","#1562EE","#BB00EF","#B50911","#E3860E","#D2BD11","#48DE0E","#1455B4","#6E009F","#7C1713","#B76B12","#8D7A13","#479C12","#165579","#51007E"];_div;saveDrawings;opacity=0;_opacitySlider;_opacityLabel;rgba;constructor(e,t){this.colorOption=t,this.saveDrawings=e,this._div=document.createElement("div"),this._div.classList.add("color-picker");let i=document.createElement("div");i.style.margin="10px",i.style.display="flex",i.style.flexWrap="wrap",G.colors.forEach((e=>i.appendChild(this.makeColorBox(e))));let s=document.createElement("div");s.style.backgroundColor=window.pane.borderColor,s.style.height="1px",s.style.width="130px";let o=document.createElement("div");o.style.margin="10px";let n=document.createElement("div");n.style.color="lightgray",n.style.fontSize="12px",n.innerText="Opacity",this._opacityLabel=document.createElement("div"),this._opacityLabel.style.color="lightgray",this._opacityLabel.style.fontSize="12px",this._opacitySlider=document.createElement("input"),this._opacitySlider.type="range",this._opacitySlider.value=(100*this.opacity).toString(),this._opacityLabel.innerText=this._opacitySlider.value+"%",this._opacitySlider.oninput=()=>{this._opacityLabel.innerText=this._opacitySlider.value+"%",this.opacity=parseInt(this._opacitySlider.value)/100,this.updateColor()},o.appendChild(n),o.appendChild(this._opacitySlider),o.appendChild(this._opacityLabel),this._div.appendChild(i),this._div.appendChild(s),this._div.appendChild(o),window.containerDiv.appendChild(this._div)}_updateOpacitySlider(){this._opacitySlider.value=(100*this.opacity).toString(),this._opacityLabel.innerText=this._opacitySlider.value+"%"}makeColorBox(e){const t=document.createElement("div");t.style.width="18px",t.style.height="18px",t.style.borderRadius="3px",t.style.margin="3px",t.style.boxSizing="border-box",t.style.backgroundColor=e,t.addEventListener("mouseover",(()=>t.style.border="2px solid lightgray")),t.addEventListener("mouseout",(()=>t.style.border="none"));const i=G.extractRGBA(e);return t.addEventListener("click",(()=>{this.rgba=i,this.updateColor()})),t}static extractRGBA(e){const t=document.createElement("div");t.style.color=e,document.body.appendChild(t);const i=getComputedStyle(t).color;document.body.removeChild(t);const s=i.match(/\d+/g)?.map(Number);if(!s)return[];let o=i.includes("rgba")?parseFloat(i.split(",")[3]):1;return[s[0],s[1],s[2],o]}updateColor(){if(!u.lastHoveredObject||!this.rgba)return;const e=`rgba(${this.rgba[0]}, ${this.rgba[1]}, ${this.rgba[2]}, ${this.opacity})`;u.lastHoveredObject.applyOptions({[this.colorOption]:e}),this.saveDrawings()}openMenu(e){u.lastHoveredObject&&(this.rgba=G.extractRGBA(u.lastHoveredObject._options[this.colorOption]),this.opacity=this.rgba[3],this._updateOpacitySlider(),this._div.style.top=e.top-30+"px",this._div.style.left=e.right+"px",this._div.style.display="flex",setTimeout((()=>document.addEventListener("mousedown",(e=>{this._div.contains(e.target)||this.closeMenu()}))),10))}closeMenu(){document.body.removeEventListener("click",this.closeMenu),this._div.style.display="none"}}class P{static _styles=[{name:"Solid",var:t.LineStyle.Solid},{name:"Dotted",var:t.LineStyle.Dotted},{name:"Dashed",var:t.LineStyle.Dashed},{name:"Large Dashed",var:t.LineStyle.LargeDashed},{name:"Sparse Dotted",var:t.LineStyle.SparseDotted}];_div;_saveDrawings;constructor(e){this._saveDrawings=e,this._div=document.createElement("div"),this._div.classList.add("context-menu"),P._styles.forEach((e=>{this._div.appendChild(this._makeTextBox(e.name,e.var))})),window.containerDiv.appendChild(this._div)}_makeTextBox(e,t){const i=document.createElement("span");return i.classList.add("context-menu-item"),i.innerText=e,i.addEventListener("click",(()=>{u.lastHoveredObject?.applyOptions({lineStyle:t}),this._saveDrawings()})),i}openMenu(e){this._div.style.top=e.top-30+"px",this._div.style.left=e.right+"px",this._div.style.display="block",setTimeout((()=>document.addEventListener("mousedown",(e=>{this._div.contains(e.target)||this.closeMenu()}))),10)}closeMenu(){document.removeEventListener("click",this.closeMenu),this._div.style.display="none"}}function N(e){const t=[];for(const i of e)0==t.length?t.push(i.toUpperCase()):i==i.toUpperCase()?t.push(" "+i):t.push(i);return t.join("")}class R{saveDrawings;drawingTool;div;hoverItem;items=[];constructor(e,t){this.saveDrawings=e,this.drawingTool=t,this._onRightClick=this._onRightClick.bind(this),this.div=document.createElement("div"),this.div.classList.add("context-menu"),document.body.appendChild(this.div),this.hoverItem=null,document.body.addEventListener("contextmenu",this._onRightClick)}_handleClick=e=>this._onClick(e);_onClick(e){e.target&&(this.div.contains(e.target)||(this.div.style.display="none",document.body.removeEventListener("click",this._handleClick)))}_onRightClick(e){if(!u.hoveredObject)return;for(const e of this.items)this.div.removeChild(e);this.items=[];for(const e of Object.keys(u.hoveredObject._options)){let t;if(e.toLowerCase().includes("color"))t=new G(this.saveDrawings,e);else{if("lineStyle"!==e)continue;t=new P(this.saveDrawings)}let i=e=>t.openMenu(e);this.menuItem(N(e),i,(()=>{document.removeEventListener("click",t.closeMenu),t._div.style.display="none"}))}this.separator(),this.menuItem("Delete Drawing",(()=>this.drawingTool.delete(u.lastHoveredObject))),e.preventDefault(),this.div.style.left=e.clientX+"px",this.div.style.top=e.clientY+"px",this.div.style.display="block",document.body.addEventListener("click",this._handleClick)}menuItem(e,t,i=null){const s=document.createElement("span");s.classList.add("context-menu-item"),this.div.appendChild(s);const o=document.createElement("span");if(o.innerText=e,o.style.pointerEvents="none",s.appendChild(o),i){let e=document.createElement("span");e.innerText="►",e.style.fontSize="8px",e.style.pointerEvents="none",s.appendChild(e)}if(s.addEventListener("mouseover",(()=>{this.hoverItem&&this.hoverItem.closeAction&&this.hoverItem.closeAction(),this.hoverItem={elem:o,action:t,closeAction:i}})),i){let e;s.addEventListener("mouseover",(()=>e=setTimeout((()=>t(s.getBoundingClientRect())),100))),s.addEventListener("mouseout",(()=>clearTimeout(e)))}else s.addEventListener("click",(e=>{t(e),this.div.style.display="none"}));this.items.push(s)}separator(){const e=document.createElement("div");e.style.width="90%",e.style.height="1px",e.style.margin="3px 0px",e.style.backgroundColor=window.pane.borderColor,this.div.appendChild(e),this.items.push(e)}}class $ extends x{_type="RayLine";constructor(e,t){super({...e},t),this._point.time=e.time}updatePoints(...e){for(const t of e)t&&(this._point=t);this.requestUpdate()}_onDrag(e){this._addDiffToPoint(this._point,e.logical,e.price),this.requestUpdate()}_mouseIsOverDrawing(e,t=4){if(!e.point)return!1;const i=this.series.priceToCoordinate(this._point.price),s=this._point.time?this.chart.timeScale().timeToCoordinate(this._point.time):null;return!(!i||!s)&&(Math.abs(i-e.point.y)<t&&e.point.x>s-t)}}class B extends _{_point={x:null,y:null};constructor(e,t){super(t),this._point=e}draw(e){e.useBitmapCoordinateSpace((e=>{if(null==this._point.x)return;const t=e.context,i=this._point.x*e.horizontalPixelRatio;t.lineWidth=this._options.width,t.strokeStyle=this._options.lineColor,g(t,this._options.lineStyle),t.beginPath(),t.moveTo(i,0),t.lineTo(i,e.bitmapSize.height),t.stroke()}))}}class A extends v{_source;_point={x:null,y:null};constructor(e){super(e),this._source=e}update(){const e=this._source._point,t=this._source.chart.timeScale(),i=this._source.series;this._point.x=e.time?t.timeToCoordinate(e.time):t.logicalToCoordinate(e.logical),this._point.y=i.priceToCoordinate(e.price)}renderer(){return new B(this._point,this._source._options)}}class O{_source;_x=null;constructor(e){this._source=e}update(){if(!this._source.chart||!this._source._point)return;const e=this._source._point,t=this._source.chart.timeScale();this._x=e.time?t.timeToCoordinate(e.time):t.logicalToCoordinate(e.logical)}visible(){return!!this._source._options.text}tickVisible(){return!0}coordinate(){return this._x??0}text(){return this._source._options.text||""}textColor(){return"white"}backColor(){return this._source._options.lineColor}}class F extends u{_type="VerticalLine";_paneViews;_timeAxisViews;_point;_callbackName;_startDragPoint=null;constructor(e,t,i=null){super(t),this._point=e,this._paneViews=[new A(this)],this._callbackName=i,this._timeAxisViews=[new O(this)]}updateAllViews(){this._paneViews.forEach((e=>e.update())),this._timeAxisViews.forEach((e=>e.update()))}timeAxisViews(){return this._timeAxisViews}updatePoints(...e){for(const t of e)t&&(!t.time&&t.logical&&(t.time=this.series.dataByIndex(t.logical)?.time||null),this._point=t);this.requestUpdate()}get points(){return[this._point]}_moveToState(e){switch(e){case p.NONE:document.body.style.cursor="default",this._unsubscribe("mousedown",this._handleMouseDownInteraction);break;case p.HOVERING:document.body.style.cursor="pointer",this._unsubscribe("mouseup",this._childHandleMouseUpInteraction),this._subscribe("mousedown",this._handleMouseDownInteraction),this.chart.applyOptions({handleScroll:!0});break;case p.DRAGGING:document.body.style.cursor="grabbing",this._subscribe("mouseup",this._childHandleMouseUpInteraction),this.chart.applyOptions({handleScroll:!1})}this._state=e}_onDrag(e){this._addDiffToPoint(this._point,e.logical,0),this.requestUpdate()}_mouseIsOverDrawing(e,t=4){if(!e.point)return!1;const i=this.chart.timeScale();let s;return s=this._point.time?i.timeToCoordinate(this._point.time):i.logicalToCoordinate(this._point.logical),!!s&&Math.abs(s-e.point.x)<t}_onMouseDown(){this._startDragPoint=null;if(this._latestHoverPoint)return this._moveToState(p.DRAGGING)}_childHandleMouseUpInteraction=()=>{this._handleMouseUpInteraction(),this._callbackName&&window.callbackFunction(`${this._callbackName}_~_${this._point.price.toFixed(8)}`)}}class H{static TREND_SVG='<rect x="3.84" y="13.67" transform="matrix(0.7071 -0.7071 0.7071 0.7071 -5.9847 14.4482)" width="21.21" height="1.56"/><path d="M23,3.17L20.17,6L23,8.83L25.83,6L23,3.17z M23,7.41L21.59,6L23,4.59L24.41,6L23,7.41z"/><path d="M6,20.17L3.17,23L6,25.83L8.83,23L6,20.17z M6,24.41L4.59,23L6,21.59L7.41,23L6,24.41z"/>';static HORZ_SVG='<rect x="4" y="14" width="9" height="1"/><rect x="16" y="14" width="9" height="1"/><path d="M11.67,14.5l2.83,2.83l2.83-2.83l-2.83-2.83L11.67,14.5z M15.91,14.5l-1.41,1.41l-1.41-1.41l1.41-1.41L15.91,14.5z"/>';static RAY_SVG='<rect x="8" y="14" width="17" height="1"/><path d="M3.67,14.5l2.83,2.83l2.83-2.83L6.5,11.67L3.67,14.5z M7.91,14.5L6.5,15.91L5.09,14.5l1.41-1.41L7.91,14.5z"/>';static BOX_SVG='<rect x="8" y="6" width="12" height="1"/><rect x="9" y="22" width="11" height="1"/><path d="M3.67,6.5L6.5,9.33L9.33,6.5L6.5,3.67L3.67,6.5z M7.91,6.5L6.5,7.91L5.09,6.5L6.5,5.09L7.91,6.5z"/><path d="M19.67,6.5l2.83,2.83l2.83-2.83L22.5,3.67L19.67,6.5z M23.91,6.5L22.5,7.91L21.09,6.5l1.41-1.41L23.91,6.5z"/><path d="M19.67,22.5l2.83,2.83l2.83-2.83l-2.83-2.83L19.67,22.5z M23.91,22.5l-1.41,1.41l-1.41-1.41l1.41-1.41L23.91,22.5z"/><path d="M3.67,22.5l2.83,2.83l2.83-2.83L6.5,19.67L3.67,22.5z M7.91,22.5L6.5,23.91L5.09,22.5l1.41-1.41L7.91,22.5z"/><rect x="22" y="9" width="1" height="11"/><rect x="6" y="9" width="1" height="11"/>';static VERT_SVG=H.RAY_SVG;div;activeIcon=null;buttons=[];_commandFunctions;_handlerID;_drawingTool;constructor(e,t,i,s){this._handlerID=e,this._commandFunctions=s,this._drawingTool=new C(t,i,(()=>this.removeActiveAndSave())),this.div=this._makeToolBox(),new R(this.saveDrawings,this._drawingTool),s.push((e=>{if((e.metaKey||e.ctrlKey)&&"KeyZ"===e.code){const e=this._drawingTool.drawings.pop();return e&&this._drawingTool.delete(e),!0}return!1}))}toJSON(){const{...e}=this;return e}_makeToolBox(){let e=document.createElement("div");e.classList.add("toolbox"),this.buttons.push(this._makeToolBoxElement(L,"KeyT",H.TREND_SVG)),this.buttons.push(this._makeToolBoxElement(x,"KeyH",H.HORZ_SVG)),this.buttons.push(this._makeToolBoxElement($,"KeyR",H.RAY_SVG)),this.buttons.push(this._makeToolBoxElement(M,"KeyB",H.BOX_SVG)),this.buttons.push(this._makeToolBoxElement(F,"KeyV",H.VERT_SVG,!0));for(const t of this.buttons)e.appendChild(t);return e}_makeToolBoxElement(e,t,i,s=!1){const o=document.createElement("div");o.classList.add("toolbox-button");const n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.setAttribute("width","29"),n.setAttribute("height","29");const r=document.createElementNS("http://www.w3.org/2000/svg","g");r.innerHTML=i,r.setAttribute("fill",window.pane.color),n.appendChild(r),o.appendChild(n);const a={div:o,group:r,type:e};return o.addEventListener("click",(()=>this._onIconClick(a))),this._commandFunctions.push((e=>this._handlerID===window.handlerInFocus&&(!(!e.altKey||e.code!==t)&&(e.preventDefault(),this._onIconClick(a),!0)))),1==s&&(n.style.transform="rotate(90deg)",n.style.transformBox="fill-box",n.style.transformOrigin="center"),o}_onIconClick(e){this.activeIcon&&(this.activeIcon.div.classList.remove("active-toolbox-button"),window.setCursor("crosshair"),this._drawingTool?.stopDrawing(),this.activeIcon===e)?this.activeIcon=null:(this.activeIcon=e,this.activeIcon.div.classList.add("active-toolbox-button"),window.setCursor("crosshair"),this._drawingTool?.beginDrawing(this.activeIcon.type))}removeActiveAndSave=()=>{window.setCursor("default"),this.activeIcon&&this.activeIcon.div.classList.remove("active-toolbox-button"),this.activeIcon=null,this.saveDrawings()};addNewDrawing(e){this._drawingTool.addNewDrawing(e)}clearDrawings(){this._drawingTool.clearDrawings()}saveDrawings=()=>{const e=[];for(const t of this._drawingTool.drawings)e.push({type:t._type,points:t.points,options:t._options});const t=JSON.stringify(e);window.callbackFunction(`save_drawings${this._handlerID}_~_${t}`)};loadDrawings(e){e.forEach((e=>{switch(e.type){case"Box":this._drawingTool.addNewDrawing(new M(e.points[0],e.points[1],e.options));break;case"TrendLine":this._drawingTool.addNewDrawing(new L(e.points[0],e.points[1],e.options));break;case"HorizontalLine":this._drawingTool.addNewDrawing(new x(e.points[0],e.options));break;case"RayLine":this._drawingTool.addNewDrawing(new $(e.points[0],e.options));break;case"VerticalLine":this._drawingTool.addNewDrawing(new F(e.points[0],e.options))}}))}}class V{makeButton;callbackName;div;isOpen=!1;widget;constructor(e,t,i,s,o,n){this.makeButton=e,this.callbackName=t,this.div=document.createElement("div"),this.div.classList.add("topbar-menu"),this.widget=this.makeButton(s+" ↓",null,o,!0,n),this.updateMenuItems(i),this.widget.elem.addEventListener("click",(()=>{if(this.isOpen=!this.isOpen,!this.isOpen)return void(this.div.style.display="none");let e=this.widget.elem.getBoundingClientRect();this.div.style.display="flex",this.div.style.flexDirection="column";let t=e.x+e.width/2;this.div.style.left=t-this.div.clientWidth/2+"px",this.div.style.top=e.y+e.height+"px"})),document.body.appendChild(this.div)}updateMenuItems(e){this.div.innerHTML="",e.forEach((e=>{let t=this.makeButton(e,null,!1,!1);t.elem.addEventListener("click",(()=>{this._clickHandler(t.elem.innerText)})),t.elem.style.margin="4px 4px",t.elem.style.padding="2px 2px",this.div.appendChild(t.elem)})),this.widget.elem.innerText=e[0]+" ↓"}_clickHandler(e){this.widget.elem.innerText=e+" ↓",window.callbackFunction(`${this.callbackName}_~_${e}`),this.div.style.display="none",this.isOpen=!1}}class U{_handler;_div;left;right;constructor(e){this._handler=e,this._div=document.createElement("div"),this._div.classList.add("topbar");const t=e=>{const t=document.createElement("div");return t.classList.add("topbar-container"),t.style.justifyContent=e,this._div.appendChild(t),t};this.left=t("flex-start"),this.right=t("flex-end")}makeSwitcher(e,t,i,s="left"){const o=document.createElement("div");let n;o.style.margin="4px 12px";const r={elem:o,callbackName:i,intervalElements:e.map((e=>{const i=document.createElement("button");i.classList.add("topbar-button"),i.classList.add("switcher-button"),i.style.margin="0px 2px",i.innerText=e,e==t&&(n=i,i.classList.add("active-switcher-button"));const s=U.getClientWidth(i);return i.style.minWidth=s+1+"px",i.addEventListener("click",(()=>r.onItemClicked(i))),o.appendChild(i),i})),onItemClicked:e=>{e!=n&&(n.classList.remove("active-switcher-button"),e.classList.add("active-switcher-button"),n=e,window.callbackFunction(`${r.callbackName}_~_${e.innerText}`))}};return this.appendWidget(o,s,!0),r}makeTextBoxWidget(e,t="left",i=null){if(i){const s=document.createElement("input");return s.classList.add("topbar-textbox-input"),s.value=e,s.style.width=`${s.value.length+2}ch`,s.addEventListener("focus",(()=>{window.textBoxFocused=!0})),s.addEventListener("input",(e=>{e.preventDefault(),s.style.width=`${s.value.length+2}ch`})),s.addEventListener("keydown",(e=>{"Enter"==e.key&&(e.preventDefault(),s.blur())})),s.addEventListener("blur",(()=>{window.callbackFunction(`${i}_~_${s.value}`),window.textBoxFocused=!1})),this.appendWidget(s,t,!0),s}{const i=document.createElement("div");return i.classList.add("topbar-textbox"),i.innerText=e,this.appendWidget(i,t,!0),i}}makeMenu(e,t,i,s,o){return new V(this.makeButton.bind(this),s,e,t,i,o)}makeButton(e,t,i,s=!0,o="left",n=!1){let r=document.createElement("button");r.classList.add("topbar-button"),r.innerText=e,document.body.appendChild(r),r.style.minWidth=r.clientWidth+1+"px",document.body.removeChild(r);let a={elem:r,callbackName:t};if(t){let e;if(n){let t=!1;e=()=>{t=!t,window.callbackFunction(`${a.callbackName}_~_${t}`),r.style.backgroundColor=t?"var(--active-bg-color)":"",r.style.color=t?"var(--active-color)":""}}else e=()=>window.callbackFunction(`${a.callbackName}_~_${r.innerText}`);r.addEventListener("click",e)}return s&&this.appendWidget(r,o,i),a}makeSeparator(e="left"){const t=document.createElement("div");t.classList.add("topbar-seperator");("left"==e?this.left:this.right).appendChild(t)}appendWidget(e,t,i){const s="left"==t?this.left:this.right;i?("left"==t&&s.appendChild(e),this.makeSeparator(t),"right"==t&&s.appendChild(e)):s.appendChild(e),this._handler.reSize()}static getClientWidth(e){document.body.appendChild(e);const t=e.clientWidth;return document.body.removeChild(e),t}}function z(e,t){if(e.startsWith("#"))return function(e,t){if(e=e.replace(/^#/,""),!/^([0-9A-F]{3}){1,2}$/i.test(e))throw new Error("Invalid hex color format.");const[i,s,o]=(e=>3===e.length?[parseInt(e[0]+e[0],16),parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16)]:[parseInt(e.slice(0,2),16),parseInt(e.slice(2,4),16),parseInt(e.slice(4,6),16)])(e);return`rgba(${i}, ${s}, ${o}, ${t})`}(e,t);if(e.startsWith("rgba")||e.startsWith("rgb"))return e.replace(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*[\d.]+)?\)/,`rgba($1, $2, $3, ${t})`);throw new Error("Unsupported color format. Use hex, rgb, or rgba.")}function W(e,t=.2){let[i,s,o,n=1]=e.startsWith("#")?[...(r=e,3===(r=r.replace(/^#/,"")).length?[parseInt(r[0]+r[0],16),parseInt(r[1]+r[1],16),parseInt(r[2]+r[2],16)]:[parseInt(r.slice(0,2),16),parseInt(r.slice(2,4),16),parseInt(r.slice(4,6),16)]),1]:e.match(/\d+(\.\d+)?/g).map(Number);var r;return i=Math.max(0,Math.min(255,i*(1-t))),s=Math.max(0,Math.min(255,s*(1-t))),o=Math.max(0,Math.min(255,o*(1-t))),e.startsWith("#")?`#${((1<<24)+(Math.round(i)<<16)+(Math.round(s)<<8)+Math.round(o)).toString(16).slice(1)}`:`rgba(${Math.round(i)}, ${Math.round(s)}, ${Math.round(o)}, ${n})`}function j(e){return function(e){return Math.max(1,Math.floor(e))}(e)/e}class q{_data=null;_options=null;draw(e,t){e.useBitmapCoordinateSpace((e=>this._drawImpl(e,t)))}update(e,t){this._data=e,this._options=t}_seggregate(e,t){const i=this._options?.chandelierSize||1,s=[];for(let o=0;o<e.length;o+=i){const n=e.slice(o,o+i),r=n.length<i&&o+n.length===e.length,a=this._chandelier(n,o,o+n.length-1,t,r);s.push(a)}return s}_chandelier(e,t,i,s,o=!1){const n=e[0].originalData?.open??e[0].open??0,r=e[e.length-1].originalData?.close??e[e.length-1].close??0,a=s(n)??0,l=s(r)??0,h=Math.max(...e.map((e=>e.originalData?.high??e.high))),d=Math.min(...e.map((e=>e.originalData?.low??e.low))),c=s(h)??0,p=s(d)??0,u=e[0].x,_=r>n,m=_?this._options?.upColor||"rgba(0,255,0,.333)":this._options?.downColor||"rgba(255,0,0,.333)",g=_?this._options?.borderUpColor||z(m,1):this._options?.borderDownColor||z(m,1);return{open:a,high:c,low:p,close:l,x:u,isUp:_,startIndex:t,endIndex:i,isInProgress:o,color:m,borderColor:g,wickColor:_?this._options?.wickUpColor||g:this._options?.wickDownColor||g}}_drawImpl(e,t){if(null===this._data||0===this._data.bars.length||null===this._data.visibleRange||null===this._options)return;let i=-1/0;const s=this._data.bars.map(((e,t)=>{const s=e.originalData.close>=e.originalData.open;i=e.originalData.close??i;const o=e.originalData.open??0,n=e.originalData.high??0,r=e.originalData.low??0,a=e.originalData.close??0,l=s?this._options?.downColor||"rgba(0,0,0,0)":this._options?.upColor||"rgba(0,0,0,0)",h=s?this._options?.borderDownColor||l:this._options?.borderUpColor||l,d=s?this._options?.wickDownColor||l:this._options?.wickUpColor||l;return{open:o,high:n,low:r,close:a,x:e.x,isUp:s,startIndex:t,endIndex:t,color:l,borderColor:h,wickColor:d}})),o=this._seggregate(s,t),n=this._options.radius(this._data.barSpacing),{horizontalPixelRatio:r,verticalPixelRatio:a}=e,l=this._data.barSpacing*r;this._drawCandles(e,o,this._data.visibleRange,n,l,r,a),this._drawWicks(e,o,this._data.visibleRange)}_drawWicks(e,t,i){if(null===this._data||null===this._options||!this._options?.wickVisible)return;if("3d"===this._options.shape)return;const{context:s,horizontalPixelRatio:o,verticalPixelRatio:n}=e,r=this._data.barSpacing*o,a=j(o);for(const e of t){if(e.startIndex<i.from||e.endIndex>i.to)continue;s.fillStyle=e.wickColor;const t=e.low*n,l=e.high*n,h=Math.min(e.open,e.close)*n,d=Math.max(e.open,e.close)*n,c=this._options?.barSpacing??.8;let p=e.x*o;const u=e.endIndex-e.startIndex;u&&u>1&&(p=p+r*Math.max(1,u)/2-(1-c)*r);let _=l,m=h,g=d,w=t;s.save(),s.lineWidth=this._options?.lineWidth??1,"Polygon"===this._options.shape&&(m=(l+h)/2,g=(t+d)/2);const v=m-_;v>0&&s.strokeRect(p-Math.floor(a/2),_,a,v);const y=w-g;y>0&&s.strokeRect(p-Math.floor(a/2),g,a,y),s.restore()}}_drawCandles(e,t,i,s,o,n,r){const{context:a}=e,l=this._options?.barSpacing??.8;for(const e of t){const t=e.endIndex-e.startIndex;let h=1!==this._options?.chandelierSize?o*Math.max(1,t+1)-(1-l)*o:o*l;const d=e.x*n,c=o*l;if(e.startIndex<i.from||e.endIndex>i.to)continue;const p=Math.min(e.open,e.close)*r,u=Math.max(e.open,e.close)*r,_=p-u,m=(p+u)/2;switch(a.save(),a.fillStyle=e.color,a.strokeStyle=e.borderColor,a.lineWidth=1.5,g(a,this._options?.lineStyle??1),a.lineWidth=this._options?.lineWidth??1,this._options?.shape){case"Rectangle":default:this._drawCandle(a,d,m,c,h,_);break;case"Rounded":this._drawRounded(a,d,u,c,h,_,s,n);break;case"Ellipse":this._drawEllipse(a,d,m,c,h,_);break;case"Arrow":this._drawArrow(a,d,p,u,c,h,e.high*r,e.low*r,e.isUp);break;case"3d":this._draw3d(a,d,e.high*r,e.low*r,e.open*r,e.close*r,c,h,e.color,e.borderColor,e.isUp,l);break;case"Polygon":this._drawPolygon(a,d,u+_,u,c,h,e.high*r,e.low*r,e.isUp)}a.restore()}}_drawCandle(e,t,i,s,o,n){const r=t-s/2,a=t-s/2+o,l=i-n/2,h=i+n/2;e.beginPath(),e.moveTo(r,l),e.lineTo(r,h),e.lineTo(a,h),e.lineTo(a,l),e.closePath(),e.fill(),e.stroke()}_drawEllipse(e,t,i,s,o,n){const r=o/2,a=n/2,l=t-s/2+o/2;e.beginPath(),e.ellipse(l,i,Math.abs(r),Math.abs(a),0,0,2*Math.PI),e.fill(),e.stroke()}_drawRounded(e,t,i,s,o,n,r,a){if(e.roundRect){const l=Math.abs(Math.min(r,.1*Math.min(s,n),5))*a;e.beginPath(),e.roundRect(t-s/2,i,o,n,l),e.stroke(),e.fill()}else e.strokeRect(t-s/2,i,o,n),e.fillRect(t-s/2,i,o,n)}_draw3d(e,t,i,s,o,n,r,a,l,h,d,c){const p=-Math.max(a,1)*(1-c),u=W(l,.666),_=W(l,.333),m=W(l,.2),g=t-r/2,w=t-r/2+a+p,v=g-p,y=w-p;let b,f,x,C;d?(b=o,f=s,x=i,C=n):(b=o,f=i,x=s,C=n),e.fillStyle=_,e.strokeStyle=h,e.fillStyle=m,d?(e.fillStyle=u,e.beginPath(),e.moveTo(g,f),e.lineTo(v,C),e.lineTo(y,C),e.lineTo(w,f),e.closePath(),e.fill(),e.stroke(),e.fillStyle=u,e.beginPath(),e.moveTo(g,b),e.lineTo(v,x),e.lineTo(v,C),e.lineTo(g,f),e.closePath(),e.fill(),e.stroke(),e.fillStyle=u,e.beginPath(),e.moveTo(w,b),e.lineTo(y,x),e.lineTo(y,C),e.lineTo(w,f),e.closePath(),e.fill(),e.stroke(),e.fillStyle=m,e.beginPath(),e.moveTo(g,b),e.lineTo(v,x),e.lineTo(y,x),e.lineTo(w,b),e.closePath(),e.fill(),e.stroke()):(e.fillStyle=m,e.beginPath(),e.moveTo(g,b),e.lineTo(v,x),e.lineTo(y,x),e.lineTo(w,b),e.closePath(),e.fill(),e.stroke(),e.fillStyle=_,e.beginPath(),e.moveTo(w,b),e.lineTo(y,x),e.lineTo(y,C),e.lineTo(w,f),e.closePath(),e.fill(),e.stroke(),e.fillStyle=_,e.beginPath(),e.moveTo(g,b),e.lineTo(v,x),e.lineTo(v,C),e.lineTo(g,f),e.closePath(),e.fill(),e.stroke(),e.fillStyle=_,e.beginPath(),e.moveTo(g,f),e.lineTo(v,C),e.lineTo(y,C),e.lineTo(w,f),e.closePath(),e.fill(),e.stroke())}_drawPolygon(e,t,i,s,o,n,r,a,l){e.beginPath(),l?(e.moveTo(t-o/2,i),e.lineTo(t+n-o/2,r),e.lineTo(t+n-o/2,s),e.lineTo(t-o/2,a)):(e.moveTo(t-o/2,r),e.lineTo(t+n-o/2,i),e.lineTo(t+n-o/2,a),e.lineTo(t-o/2,s)),e.closePath(),e.stroke(),e.fill()}_drawArrow(e,t,i,s,o,n,r,a,l){e.beginPath();const h=t-o/2,d=h+n,c=h+n/2;l?(e.moveTo(h,a),e.lineTo(h,i),e.lineTo(c,r),e.lineTo(d,i),e.lineTo(d,a),e.lineTo(c,s),e.lineTo(h,a)):(e.moveTo(h,r),e.lineTo(h,s),e.lineTo(c,a),e.lineTo(d,s),e.lineTo(d,r),e.lineTo(c,i),e.lineTo(h,r)),e.closePath(),e.fill(),e.stroke()}}const K={...t.customSeriesDefaultOptions,upColor:"#26a69a",downColor:"#ef5350",wickVisible:!0,borderVisible:!0,borderColor:"#378658",borderUpColor:"#26a69a",borderDownColor:"#ef5350",wickColor:"#737375",wickUpColor:"#26a69a",wickDownColor:"#ef5350",radius:function(e){return e<4?0:e/3},shape:"Rectangle",chandelierSize:1,barSpacing:.8,lineStyle:0,lineWidth:1};class X{_renderer;constructor(){this._renderer=new q}priceValueBuilder(e){return[e.high,e.low,e.close]}renderer(){return this._renderer}isWhitespace(e){return void 0===e.close}update(e,t){this._renderer.update(e,t)}defaultOptions(){return K}}s();return e.Box=M,e.Handler=class{id;commandFunctions=[];wrapper;div;chart;scale;precision=2;series;volumeSeries;legend;_topBar;toolBox;spinner;_seriesList=[];seriesMap=new Map;constructor(e,t,i,s,o){this.reSize=this.reSize.bind(this),this.id=e,this.scale={width:t,height:i},this.wrapper=document.createElement("div"),this.wrapper.classList.add("handler"),this.wrapper.style.float=s,this.div=document.createElement("div"),this.div.style.position="relative",this.wrapper.appendChild(this.div),window.containerDiv.append(this.wrapper),this.chart=this._createChart(),this.series=this.createCandlestickSeries(),this.volumeSeries=this.createVolumeSeries(),this.legend=new l(this),document.addEventListener("keydown",(e=>{for(let t=0;t<this.commandFunctions.length&&!this.commandFunctions[t](e);t++);})),window.handlerInFocus=this.id,this.wrapper.addEventListener("mouseover",(()=>window.handlerInFocus=this.id)),this.reSize(),o&&window.addEventListener("resize",(()=>this.reSize()))}reSize(){let e=0!==this.scale.height&&this._topBar?._div.offsetHeight||0;this.chart.resize(window.innerWidth*this.scale.width,window.innerHeight*this.scale.height-e),this.wrapper.style.width=100*this.scale.width+"%",this.wrapper.style.height=100*this.scale.height+"%",0===this.scale.height||0===this.scale.width?this.toolBox&&(this.toolBox.div.style.display="none"):this.toolBox&&(this.toolBox.div.style.display="flex")}primitives=new Map;_createChart(){return t.createChart(this.div,{width:window.innerWidth*this.scale.width,height:window.innerHeight*this.scale.height,layout:{textColor:window.pane.color,background:{color:"#000000",type:t.ColorType.Solid},fontSize:12},rightPriceScale:{scaleMargins:{top:.3,bottom:.25}},timeScale:{timeVisible:!0,secondsVisible:!1},crosshair:{mode:t.CrosshairMode.Normal,vertLine:{labelBackgroundColor:"rgb(46, 46, 46)"},horzLine:{labelBackgroundColor:"rgb(55, 55, 55)"}},grid:{vertLines:{color:"rgba(29, 30, 38, 5)"},horzLines:{color:"rgba(29, 30, 58, 5)"}},handleScroll:{vertTouchDrag:!0}})}createCandlestickSeries(){const e="rgba(39, 157, 130, 100)",t="rgba(200, 97, 100, 100)",i=this.chart.addCandlestickSeries({upColor:e,borderUpColor:e,wickUpColor:e,downColor:t,borderDownColor:t,wickDownColor:t});return i.priceScale().applyOptions({scaleMargins:{top:.2,bottom:.2}}),i}createVolumeSeries(){const e=this.chart.addHistogramSeries({color:"#26a69a",priceFormat:{type:"volume"},priceScaleId:"volume_scale"});return e.priceScale().applyOptions({scaleMargins:{top:.8,bottom:0}}),e}createLineSeries(e,t){const{group:i,legendSymbol:s="▨",...o}=t,n=this.chart.addLineSeries(o);this._seriesList.push(n),this.seriesMap.set(e,n);const r=n.options().color||"rgba(255,0,0,1)",a={name:e,series:n,colors:[r.startsWith("rgba")?r.replace(/[^,]+(?=\))/,"1"):r],legendSymbol:[s],seriesType:"Line",group:i};return this.legend.addLegendItem(a),{name:e,series:n}}createHistogramSeries(e,t){const{group:i,legendSymbol:s="▨",...o}=t,n=this.chart.addHistogramSeries(o);this._seriesList.push(n),this.seriesMap.set(e,n);const r=n.options().color||"rgba(255,0,0,1)",a={name:e,series:n,colors:[r.startsWith("rgba")?r.replace(/[^,]+(?=\))/,"1"):r],legendSymbol:[s],seriesType:"Histogram",group:i};return this.legend.addLegendItem(a),{name:e,series:n}}createAreaSeries(e,t){const{group:i,legendSymbol:s="▨",...o}=t,n=this.chart.addAreaSeries(o);this._seriesList.push(n),this.seriesMap.set(e,n);const r=n.options().lineColor||"rgba(255,0,0,1)",a={name:e,series:n,colors:[r.startsWith("rgba")?r.replace(/[^,]+(?=\))/,"1"):r],legendSymbol:[s],seriesType:"Area",group:i};return this.legend.addLegendItem(a),{name:e,series:n}}createBarSeries(e,t){const{group:i,legendSymbol:s=["▨","▨"],...o}=t,n=this.chart.addBarSeries(o);this._seriesList.push(n),this.seriesMap.set(e,n);const r=n.options().upColor||"rgba(0,255,0,1)",a=n.options().downColor||"rgba(255,0,0,1)",l={name:e,series:n,colors:[r,a],legendSymbol:s,seriesType:"Bar",group:i};return this.legend.addLegendItem(l),{name:e,series:n}}createCustomOHLCSeries(e,t={}){const i="ohlc",s={...K,...t,seriesType:i},{group:o,legendSymbol:n=["⑃","⑂"],chandelierSize:r=1,...a}=s,l=new X,h=this.chart.addCustomSeries(l,{...a,chandelierSize:r});this._seriesList.push(h),this.seriesMap.set(e,h);const d={name:e,series:h,colors:[s.borderUpColor||s.upColor,s.borderDownColor||s.downColor],legendSymbol:r>1?n.map((e=>`${e} (${r})`)):n,seriesType:i,group:o};return this.legend.addLegendItem(d),{name:e,series:h}}removeSeries(e){const t=this.seriesMap.get(e);t?(this.chart.removeSeries(t),this._seriesList=this._seriesList.filter((e=>e!==t)),this.seriesMap.delete(e),this.legend.deleteLegendEntry(e),console.log(`Series "${e}" removed.`)):console.warn(`Series "${e}" not found.`)}createToolBox(){this.toolBox=new H(this.id,this.chart,this.series,this.commandFunctions),this.div.appendChild(this.toolBox.div)}createTopBar(){return this._topBar=new U(this),this.wrapper.prepend(this._topBar._div),this._topBar}toJSON(){const{chart:e,...t}=this;return t}static syncCharts(e,t,i=!1){function s(e,t){t?(e.chart.setCrosshairPosition(t.value||t.close,t.time,e.series),e.legend.legendHandler(t,!0)):e.chart.clearCrosshairPosition()}function o(e,t){return t.time&&t.seriesData.get(e)||null}const n=e.chart.timeScale(),r=t.chart.timeScale(),a=e=>{e&&n.setVisibleLogicalRange(e)},l=e=>{e&&r.setVisibleLogicalRange(e)},h=i=>{s(t,o(e.series,i))},d=i=>{s(e,o(t.series,i))};let c=t;function p(e,t,s,o,n,r){e.wrapper.addEventListener("mouseover",(()=>{c!==e&&(c=e,t.chart.unsubscribeCrosshairMove(s),e.chart.subscribeCrosshairMove(o),i||(t.chart.timeScale().unsubscribeVisibleLogicalRangeChange(n),e.chart.timeScale().subscribeVisibleLogicalRangeChange(r)))}))}p(t,e,h,d,l,a),p(e,t,d,h,a,l),t.chart.subscribeCrosshairMove(d);const u=r.getVisibleLogicalRange();u&&n.setVisibleLogicalRange(u),i||t.chart.timeScale().subscribeVisibleLogicalRangeChange(a)}static makeSearchBox(e){const t=document.createElement("div");t.classList.add("searchbox"),t.style.display="none";const i=document.createElement("div");i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1"><path style="fill:none;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;stroke:lightgray;stroke-opacity:1;stroke-miterlimit:4;" d="M 15 15 L 21 21 M 10 17 C 6.132812 17 3 13.867188 3 10 C 3 6.132812 6.132812 3 10 3 C 13.867188 3 17 6.132812 17 10 C 17 13.867188 13.867188 17 10 17 Z M 10 17 "/></svg>';const s=document.createElement("input");return s.type="text",t.appendChild(i),t.appendChild(s),e.div.appendChild(t),e.commandFunctions.push((i=>window.handlerInFocus===e.id&&!window.textBoxFocused&&("none"===t.style.display?!!/^[a-zA-Z0-9]$/.test(i.key)&&(t.style.display="flex",s.focus(),!0):("Enter"===i.key||"Escape"===i.key)&&("Enter"===i.key&&window.callbackFunction(`search${e.id}_~_${s.value}`),t.style.display="none",s.value="",!0)))),s.addEventListener("input",(()=>s.value=s.value.toUpperCase())),{window:t,box:s}}static makeSpinner(e){e.spinner=document.createElement("div"),e.spinner.classList.add("spinner"),e.wrapper.appendChild(e.spinner);let t=0;!function i(){e.spinner&&(t+=10,e.spinner.style.transform=`translate(-50%, -50%) rotate(${t}deg)`,requestAnimationFrame(i))}()}static _styleMap={"--bg-color":"backgroundColor","--hover-bg-color":"hoverBackgroundColor","--click-bg-color":"clickBackgroundColor","--active-bg-color":"activeBackgroundColor","--muted-bg-color":"mutedBackgroundColor","--border-color":"borderColor","--color":"color","--active-color":"activeColor"};static setRootStyles(e){const t=document.documentElement.style;for(const[i,s]of Object.entries(this._styleMap))t.setProperty(i,e[s])}},e.HorizontalLine=x,e.Legend=l,e.RayLine=$,e.Table=class{_div;callbackName;borderColor;borderWidth;table;rows={};headings;widths;alignments;footer;header;constructor(e,t,i,s,o,n,r=!1,a,l,h,d,c){this._div=document.createElement("div"),this.callbackName=null,this.borderColor=l,this.borderWidth=h,r?(this._div.style.position="absolute",this._div.style.cursor="move"):(this._div.style.position="relative",this._div.style.float=n),this._div.style.zIndex="2000",this.reSize(e,t),this._div.style.display="flex",this._div.style.flexDirection="column",this._div.style.borderRadius="5px",this._div.style.color="white",this._div.style.fontSize="12px",this._div.style.fontVariantNumeric="tabular-nums",this.table=document.createElement("table"),this.table.style.width="100%",this.table.style.borderCollapse="collapse",this._div.style.overflow="hidden",this.headings=i,this.widths=s.map((e=>100*e+"%")),this.alignments=o;let p=this.table.createTHead().insertRow();for(let e=0;e<this.headings.length;e++){let t=document.createElement("th");t.textContent=this.headings[e],t.style.width=this.widths[e],t.style.letterSpacing="0.03rem",t.style.padding="0.2rem 0px",t.style.fontWeight="500",t.style.textAlign="center",0!==e&&(t.style.borderLeft=h+"px solid "+l),t.style.position="sticky",t.style.top="0",t.style.backgroundColor=c.length>0?c[e]:a,t.style.color=d[e],p.appendChild(t)}let u,_,m=document.createElement("div");if(m.style.overflowY="auto",m.style.overflowX="hidden",m.style.backgroundColor=a,m.appendChild(this.table),this._div.appendChild(m),window.containerDiv.appendChild(this._div),!r)return;let g=e=>{this._div.style.left=e.clientX-u+"px",this._div.style.top=e.clientY-_+"px"},w=()=>{document.removeEventListener("mousemove",g),document.removeEventListener("mouseup",w)};this._div.addEventListener("mousedown",(e=>{u=e.clientX-this._div.offsetLeft,_=e.clientY-this._div.offsetTop,document.addEventListener("mousemove",g),document.addEventListener("mouseup",w)}))}divToButton(e,t){e.addEventListener("mouseover",(()=>e.style.backgroundColor="rgba(60, 60, 60, 0.6)")),e.addEventListener("mouseout",(()=>e.style.backgroundColor="transparent")),e.addEventListener("mousedown",(()=>e.style.backgroundColor="rgba(60, 60, 60)")),e.addEventListener("click",(()=>window.callbackFunction(t))),e.addEventListener("mouseup",(()=>e.style.backgroundColor="rgba(60, 60, 60, 0.6)"))}newRow(e,t=!1){let i=this.table.insertRow();i.style.cursor="default";for(let s=0;s<this.headings.length;s++){let o=i.insertCell();o.style.width=this.widths[s],o.style.textAlign=this.alignments[s],o.style.border=this.borderWidth+"px solid "+this.borderColor,t&&this.divToButton(o,`${this.callbackName}_~_${e};;;${this.headings[s]}`)}t||this.divToButton(i,`${this.callbackName}_~_${e}`),this.rows[e]=i}deleteRow(e){this.table.deleteRow(this.rows[e].rowIndex),delete this.rows[e]}clearRows(){let e=Object.keys(this.rows).length;for(let t=0;t<e;t++)this.table.deleteRow(-1);this.rows={}}_getCell(e,t){return this.rows[e].cells[this.headings.indexOf(t)]}updateCell(e,t,i){this._getCell(e,t).textContent=i}styleCell(e,t,i,s){this._getCell(e,t).style[i]=s}makeSection(e,t,i,s=!1){let o=document.createElement("div");o.style.display="flex",o.style.width="100%",o.style.padding="3px 0px",o.style.backgroundColor="rgb(30, 30, 30)","footer"===t?this._div.appendChild(o):this._div.prepend(o);const n=[];for(let t=0;t<i;t++){let i=document.createElement("div");o.appendChild(i),i.style.flex="1",i.style.textAlign="center",s&&(this.divToButton(i,`${e}_~_${t}`),i.style.borderRadius="2px"),n.push(i)}"footer"===t?this.footer=n:this.header=n}reSize(e,t){this._div.style.width=e<=1?100*e+"%":e+"px",this._div.style.height=t<=1?100*t+"%":t+"px"}},e.ToolBox=H,e.TopBar=U,e.TrendLine=L,e.VerticalLine=F,e.globalParamInit=s,e.ohlcSeries=X,e.ohlcdefaultOptions=K,e.paneStyleDefault=i,e.setCursor=e=>{e&&(window.cursor=e),document.body.style.cursor=window.cursor},e}({},LightweightCharts);
